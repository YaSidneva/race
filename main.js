(()=>{"use strict";function e(e,t){var n=document.createElement("button");return n.textContent=e,n.classList.add("button"),n.addEventListener("click",t),n}var t=function(){return t=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},t.apply(this,arguments)};const n=function(){function e(e,t){this.baseLink=e,this.options=t}return e.prototype.createCar=function(e,t){this.request("POST","garage",t,void 0,e)},e.prototype.updateCar=function(e,t,n){this.request("PUT","garage/".concat(t),n,{},e)},e.prototype.getCars=function(e,t,n){this.requestPage("GET","garage",n,{_page:e,_limit:t})},e.prototype.getCar=function(e,t){this.request("GET","garage/".concat(e),t)},e.prototype.removeCar=function(e,t){this.request("DELETE","garage/".concat(e),t)},e.prototype.errorHandler=function(e){if(!e.ok)throw 401!==e.status&&404!==e.status||console.log("Sorry, but there is ".concat(e.status," error: ").concat(e.statusText)),Error(e.statusText);return e},e.prototype.makeUrl=function(e,n){var a=t(t({},this.options),e),r="".concat(this.baseLink).concat(n,"?");return Object.keys(a).forEach((function(e){r+="".concat(e,"=").concat(a[e],"&")})),r.slice(0,-1)},e.prototype.request=function(e,t,n,a,r){void 0===a&&(a={}),fetch(this.makeUrl(a,t),{method:e,body:JSON.stringify(r),headers:{"Content-Type":"application/json"}}).then(this.errorHandler).then((function(e){return e.json()})).then((function(e){return n(e)})).catch((function(e){return console.error(e)}))},e.prototype.requestPage=function(e,t,n,a){void 0===a&&(a={}),fetch(this.makeUrl(a,t),{method:e,headers:{"Content-Type":"application/json"}}).then(this.errorHandler).then((function(e){return e.json().then((function(t){return n({rows:t,totalCount:+e.headers.get("X-Total-Count")})}))})).catch((function(e){return console.error(e)}))},e}();var a=function(){return a=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},a.apply(this,arguments)};const r=function(){function e(e,t){this.baseLink=e,this.options=t}return e.prototype.getWinners=function(e,t){this.requestTable("GET","winners",t,{_page:e.page,_limit:e.limit,_sort:e.sort,_order:e.order})},e.prototype.getWinner=function(e,t){fetch(this.makeUrl({},"winners/".concat(e)),{method:"GET",headers:{"Content-Type":"application/json"}}).then(t).catch((function(e){return console.error(e)}))},e.prototype.createWinner=function(e,t){this.request("POST","winners",t,{},e)},e.prototype.updateWinner=function(e,t){this.request("PUT","winners/".concat(e.id),t,{},e)},e.prototype.errorHandler=function(e){if(!e.ok)throw 401!==e.status&&404!==e.status||console.log("Sorry, but there is ".concat(e.status," error: ").concat(e.statusText)),Error(e.statusText);return e},e.prototype.makeUrl=function(e,t){var n=a(a({},this.options),e),r="".concat(this.baseLink).concat(t,"?");return Object.keys(n).forEach((function(e){r+="".concat(e,"=").concat(n[e],"&")})),r.slice(0,-1)},e.prototype.request=function(e,t,n,a,r){void 0===a&&(a={}),fetch(this.makeUrl(a,t),{method:e,body:JSON.stringify(r),headers:{"Content-Type":"application/json"}}).then(this.errorHandler).then((function(e){return e.json()})).then((function(e){return n(e)})).catch((function(e){return console.error(e)}))},e.prototype.requestTable=function(e,t,n,a){void 0===a&&(a={}),fetch(this.makeUrl(a,t),{method:e,headers:{"Content-Type":"application/json"}}).then(this.errorHandler).then((function(e){return e.json().then((function(t){return n({rows:t,totalCount:+e.headers.get("X-Total-Count")})}))})).catch((function(e){return console.error(e)}))},e}();function o(e){var t=document.createElement("div");return t.innerHTML='<svg fill="'.concat(e,'" width="50px" height="50px" viewBox="0 -39.69 122.88 122.88" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="enable-background:new 0 0 122.88 43.49" xml:space="preserve" transform="matrix(-1, 0, 0, 1, 0, 0)">\n\n    <g id="SVGRepo_bgCarrier" stroke-width="0"/>\n    \n    <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"/>\n    \n    <g id="SVGRepo_iconCarrier"> <style type="text/css">.st0{fill-rule:evenodd;clip-rule:evenodd;}</style> <g> <path class="st0" d="M103.94,23.97c5.39,0,9.76,4.37,9.76,9.76c0,5.39-4.37,9.76-9.76,9.76c-5.39,0-9.76-4.37-9.76-9.76 C94.18,28.34,98.55,23.97,103.94,23.97L103.94,23.97z M23,29.07v3.51h3.51C26.09,30.86,24.73,29.49,23,29.07L23,29.07z M26.52,34.87H23v3.51C24.73,37.97,26.09,36.6,26.52,34.87L26.52,34.87z M20.71,38.39v-3.51H17.2 C17.62,36.6,18.99,37.96,20.71,38.39L20.71,38.39z M17.2,32.59h3.51v-3.51C18.99,29.49,17.62,30.86,17.2,32.59L17.2,32.59z M105.09,29.07v3.51h3.51C108.18,30.86,106.82,29.49,105.09,29.07L105.09,29.07z M108.6,34.87h-3.51v3.51 C106.82,37.97,108.18,36.6,108.6,34.87L108.6,34.87z M102.8,38.39v-3.51h-3.51C99.71,36.6,101.07,37.96,102.8,38.39L102.8,38.39z M99.28,32.59h3.51v-3.51C101.07,29.49,99.71,30.86,99.28,32.59L99.28,32.59z M49.29,12.79c-1.54-0.35-3.07-0.35-4.61-0.28 C56.73,6.18,61.46,2.07,75.57,2.9l-1.94,12.87L50.4,16.65c0.21-0.61,0.33-0.94,0.37-1.55C50.88,13.36,50.86,13.15,49.29,12.79 L49.29,12.79z M79.12,3.13L76.6,15.6l24.13-0.98c2.48-0.1,2.91-1.19,1.41-3.28c-0.68-0.95-1.44-1.89-2.31-2.82 C93.59,1.86,87.38,3.24,79.12,3.13L79.12,3.13z M0.46,27.28H1.2c0.46-2.04,1.37-3.88,2.71-5.53c2.94-3.66,4.28-3.2,8.65-3.99 l24.46-4.61c5.43-3.86,11.98-7.3,19.97-10.2C64.4,0.25,69.63-0.01,77.56,0c4.54,0.01,9.14,0.28,13.81,0.84 c2.37,0.15,4.69,0.47,6.97,0.93c2.73,0.55,5.41,1.31,8.04,2.21l9.8,5.66c2.89,1.67,3.51,3.62,3.88,6.81l1.38,11.78h1.43v6.51 c-0.2,2.19-1.06,2.52-2.88,2.52h-2.37c0.92-20.59-28.05-24.11-27.42,1.63H34.76c3.73-17.75-14.17-23.91-22.96-13.76 c-2.67,3.09-3.6,7.31-3.36,12.3H2.03c-0.51-0.24-0.91-0.57-1.21-0.98c-1.05-1.43-0.82-5.74-0.74-8.23 C0.09,27.55-0.12,27.28,0.46,27.28L0.46,27.28z M21.86,23.97c5.39,0,9.76,4.37,9.76,9.76c0,5.39-4.37,9.76-9.76,9.76 c-5.39,0-9.76-4.37-9.76-9.76C12.1,28.34,16.47,23.97,21.86,23.97L21.86,23.97z"/> </g> </g>\n    \n    </svg>'),t}var i=function(){return i=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},i.apply(this,arguments)};const c=function(){function e(e,t){this.baseLink=e,this.options=t}return e.prototype.changeEngineStatus=function(e,t){this.request("PATCH","engine",t,{id:e.id,status:e.status})},e.prototype.changeCarEngine=function(e,t){fetch(this.makeUrl({id:"".concat(e.id),status:e.status},"engine"),{method:"PATCH",headers:{"Content-Type":"application/json"}}).then((function(e){return t(e)})).catch((function(e){return console.error(e)}))},e.prototype.errorHandler=function(e){if(!e.ok)throw 401!==e.status&&404!==e.status||console.log("Sorry, but there is ".concat(e.status," error: ").concat(e.statusText)),Error(e.statusText);return e},e.prototype.makeUrl=function(e,t){var n=i(i({},this.options),e),a="".concat(this.baseLink).concat(t,"?");return Object.keys(n).forEach((function(e){a+="".concat(e,"=").concat(n[e],"&")})),a.slice(0,-1)},e.prototype.request=function(e,t,n,a){void 0===a&&(a={}),fetch(this.makeUrl(a,t),{method:e,headers:{"Content-Type":"application/json"}}).then(this.errorHandler).then((function(e){return e.json()})).then((function(e){return n(e)})).catch((function(e){return console.error(e)}))},e}(),s=function(){function t(e){this.car=e,this.engineApi=new c("http://localhost:3000/",{}),this.roadPart=document.createElement("div"),this.roadPart.classList.add("road-part"),this.carElement=o(this.car.color),this.roadPart.appendChild(this.createStartStopBtn()),this.roadPart.appendChild(this.carElement).classList.add("car");var t=document.createElement("div");t.classList.add("flag"),this.roadPart.appendChild(t)}return t.prototype.createRoad=function(){return this.roadPart},t.prototype.createStartStopBtn=function(){var t=document.createElement("div");return t.classList.add("start-stop-block"),this.startBtn=e("A",this.startDriving.bind(this)),this.startBtn.classList.add("drive-button-start"),this.stopBtn=e("B",this.stopDriving.bind(this)),this.stopBtn.disabled=!0,this.stopBtn.classList.add("drive-button-stop"),t.appendChild(this.startBtn).classList.add("drive-btn"),t.appendChild(this.stopBtn).classList.add("drive-btn"),t},t.prototype.stopDriving=function(){this.stopBtn.disabled=!0;var e=this.car.id;this.intervalDrive&&clearInterval(this.intervalDrive),this.carElement.style.left="8px",this.startBtn.disabled=!1,this.engineApi.changeEngineStatus({id:e,status:"stopped"},(function(){}))},t.prototype.startDriving=function(){var e=this,t=this.car.id,n=this.carElement,a=this.roadPart.clientWidth-55-50;return new Promise((function(r){e.engineApi.changeEngineStatus({id:e.car.id,status:"started"},(function(o){e.startBtn.disabled=!0,e.stopBtn.disabled=!1;var i=8,c=o.velocity/50;e.intervalDrive=setInterval((function(){i>a?(clearInterval(this.intervalDrive),r(o.distance/o.velocity)):(i+=c,n.style.left="".concat(Math.floor(i),"px"))}),5),e.engineApi.changeCarEngine({status:"drive",id:t},(function(t){500===t.status&&(clearInterval(e.intervalDrive),r(1/0))}))}))}))},t}();const d=function(){function t(e){this.page=1,this.limit=7,this.pageManagmentContainer=e,this.garageApi=new n("http://localhost:3000/",{}),this.winnerApi=new r("http://localhost:3000/",{})}return t.prototype.startRace=function(){var e=this;return Promise.all(this.carElements.map((function(e){return e.startDriving().then((function(t){return{car:e.car,time:t}}))}))).then((function(e){return e.reduce((function(e,t){return t.time<e.time?t:e}),e[0])})).then((function(t){return e.winnerApi.getWinner(t.car.id,(function(n){404===n.status?e.winnerApi.createWinner({id:t.car.id,time:t.time/1e3,wins:1},(function(){})):n.json().then((function(n){e.winnerApi.updateWinner({id:n.id,wins:n.wins+1,time:Math.min(n.time,t.time/1e3)},(function(){}))}))})),t}))},t.prototype.renderPageContainer=function(){var t=this;this.pageManagmentContainer.innerHTML="";var n=document.createElement("div");n.classList.add("race-container");var a=document.createElement("div");this.pageManagmentContainer.appendChild(a),this.pageManagmentContainer.appendChild(n),this.renderGarage(this.page,this.limit,n,a),this.pageManagmentContainer.classList.add("page-manager-container");var r=document.createElement("div");r.classList.add("page-manager-block"),this.pageManagmentContainer.appendChild(r);var o=r.appendChild(e("prev",(function(){t.page-=1,t.renderGarage(t.page,t.limit,n,a),1===t.page&&(o.disabled=!0),t.page+1<(t.totalCount+t.limit)/t.limit&&(i.disabled=!1)})));1===this.page&&(o.disabled=!0),o.className="page-btn next-page-btn";var i=r.appendChild(e("next",(function(){t.page+=1,t.renderGarage(t.page,t.limit,n,a),1!==t.page&&(o.disabled=!1),t.page+1>=(t.totalCount+t.limit)/t.limit&&(i.disabled=!0)})));return i.className="page-btn prev-page-btn",this.pageManagmentContainer},t.prototype.renderGarage=function(t,n,a,r){var o=this;a.innerHTML="",this.garageApi.getCars(t,n,(function(t){o.totalCount=t.totalCount,r.classList.add("header-race"),r.innerHTML="",r.textContent="Garage (".concat(o.totalCount,")");var n=document.createElement("div");n.textContent="page ".concat(o.page),r.appendChild(n);var i=function(t,n,a){var r=document.createElement("div"),o=[];return t.rows.forEach((function(t){var i=function(t,n,a){var r=document.createElement("div");r.classList.add("item-car");var o=document.createElement("div");r.appendChild(o),o.classList.add("car-header");var i=document.createElement("div");i.classList.add("car-header-btn-block"),o.appendChild(i),i.appendChild(e("select",(function(){var e=document.querySelector(".update-car-block").querySelector(".textfield");e.value=t.name;var n=document.querySelector(".update-car-block").querySelector(".color-picker");n.value=t.color,document.querySelector(".update-car-block").querySelector(".button").onclick=function(){var r={id:t.id,name:e.value,color:n.value};a(r)}}))).classList.add("car-header-btn"),i.appendChild(e("remove",(function(){n(t.id)}))).classList.add("car-header-btn");var c=document.createElement("div");c.textContent=t.name,c.classList.add("title-car"),o.appendChild(c);var d=new s(t);return r.appendChild(d.createRoad()),[r,d]}(t,n,a),c=i[0],d=i[1];r.appendChild(c),o.push(d)})),r.classList.add("race"),[r,o]}(t,(function(e){o.garageApi.removeCar(e,(function(){o.renderPageContainer()}))}),(function(e){o.garageApi.updateCar(e,e.id,(function(){return o.renderPageContainer()}))})),c=i[0],d=i[1];o.carElements=d,a.appendChild(c)}))},t}();var l=["Ford Mustang","Toyota Camry","Chevrolet Corvette","Honda Civic","BMW 3 Series","Mercedes-Benz E-Class","Audi A4","Nissan Altima","Volkswagen Golf","Subaru Outback","Ford F-150","Toyota Prius","Chevrolet Silverado","Honda Accord","BMW 5 Series","Mercedes-Benz C-Class","Audi Q5","Nissan Maxima","Volkswagen Jetta","Subaru Forester","Dodge Challenger","Hyundai Sonata","Jeep Wrangler","GMC Sierra","Lexus RX","Ford Explorer","Toyota RAV4","Chevrolet Impala","Honda CR-V","BMW X5","Mercedes-Benz S-Class","Audi A6","Nissan Rogue","Volkswagen Passat","Subaru Crosstrek","Dodge Charger","Hyundai Elantra","Jeep Grand Cherokee","GMC Yukon","Lexus ES","Ford Escape","Toyota Highlander","Chevrolet Equinox","Honda Pilot","BMW 7 Series","Mercedes-Benz GLE","Audi Q7","Nissan Pathfinder","Volkswagen Tiguan","Subaru Legacy","Dodge Durango","Hyundai Tucson","Jeep Cherokee","GMC Acadia","Lexus GX","Ford Edge","Toyota Corolla","Chevrolet Traverse","Honda Odyssey","BMW X3","Mercedes-Benz GLC","Audi A5","Nissan Murano","Volkswagen Atlas","Subaru Ascent","Dodge Grand Caravan","Hyundai Santa Fe","Jeep Compass","GMC Terrain","Lexus NX","Ford Expedition","Toyota Tacoma","Chevrolet Colorado","Honda Fit","BMW X7","Mercedes-Benz GLA","Audi Q3","Nissan Sentra","Volkswagen Beetle","Subaru XV Crosstrek","Dodge Journey","Hyundai Accent","Jeep Renegade","GMC Canyon","Lexus IS","Ford Fusion","Toyota Sienna","Chevrolet Malibu","Honda HR-V","BMW X1","Mercedes-Benz CLA","Audi A3","Nissan Titan","Volkswagen Touareg","Subaru WRX","Dodge Nitro","Hyundai Veloster","Jeep Patriot","GMC Savana","Lexus LS","Ford Mustang Mach-E","Toyota Tundra","Chevrolet Volt","Honda Insight","BMW i3","Mercedes-Benz EQC","Audi e-tron","Nissan Leaf","Volkswagen e-Golf","Subaru BRZ","Dodge Dart","Hyundai Kona","Jeep Liberty","GMC Canyon","Lexus LC","Ford Bronco","Toyota Avalon","Chevrolet Bolt EV","Honda Clarity","BMW i8","Mercedes-Benz GLB","Audi A7","Nissan Kicks","Volkswagen Arteon","Subaru Baja","Dodge Ram","Hyundai Ioniq","Jeep Commander","GMC Jimmy","Lexus LFA","Ford Ranger","Toyota Land Cruiser","Chevrolet Cruze","Honda CR-Z","BMW Z4","Mercedes-Benz SL","Audi TT","Nissan Juke","Volkswagen CC","Subaru Tribeca","Dodge Caliber","Hyundai Genesis","Jeep Liberty","GMC Syclone","Lexus LX","Ford Excursion","Toyota Supra","Chevrolet Sonic","Honda Passport","BMW M3"];function u(t,a){var r=document.createElement("div");r.classList.add("main-container");var o=document.createElement("div");o.classList.add("update-container"),r.appendChild(o);var i=document.createElement("div");return i.classList.add("car-container"),o.appendChild(i),i.appendChild(function(n,r){var o=document.createElement("div");o.classList.add("car-block");var i=document.createElement("input");i.type="text",i.classList.add("textfield");var c=document.createElement("input");c.classList.add("color-picker"),c.type="color",c.value="#6CB4EE";var s=e("Create car",(function(){(function(e){a.createCar(e,(function(){t.renderPageContainer()}))})({name:i.value,color:c.value}),i.value="",c.value="#6CB4EE"}));return o.appendChild(i),o.appendChild(c),o.appendChild(s),o}()),i.appendChild(function(t){var n=document.createElement("div");n.className="car-block update-car-block";var a=document.createElement("input");a.type="text",a.classList.add("textfield");var r=document.createElement("input");r.classList.add("color-picker"),r.type="color",r.value="#6CB4EE";var o=e("Update car");return n.appendChild(a),n.appendChild(r),n.appendChild(o),n}()),o.appendChild(function(t){var a=document.createElement("div"),r=document.createElement("div");r.classList.add("winner-res"),r.style.display="none",a.classList.add("btn-block");var o=e("race",(function(){t.startRace().then((function(e){r.style.display="block",r.textContent="".concat(e.car.name," went first [").concat((e.time/1e3).toFixed(2),"s]!")}))})),i=e("reset",(function(){r.style.display="none",document.querySelectorAll(".drive-button-stop").forEach((function(e){return e.click()}))})),c=new n("http://localhost:3000/",{}),s=e("generate cars",(function(){for(var e=1;e<=100;e+=1){var n=Math.floor(256*Math.random()),a=Math.floor(256*Math.random()),r=Math.floor(256*Math.random()),o="rgb(".concat(n,",").concat(a,",").concat(r,")"),i=l[Math.floor(Math.random()*l.length)];c.createCar({color:o,name:i},(function(){}))}t.renderPageContainer()}));return a.appendChild(o),a.appendChild(i),a.appendChild(s),a.appendChild(r),a}(t)),r.appendChild(t.renderPageContainer()),r}(new(function(){function t(){this.garageApi=new n("http://localhost:3000/",{})}return t.prototype.start=function(){var t=this,a=document.querySelector("body"),i=document.createElement("div");a.appendChild(i);var c=document.createElement("div");c.classList.add("main-container"),a.appendChild(c);var s=document.createElement("div");s.classList.add("header-btn-block"),i.appendChild(s);var l=document.createElement("div");this.pageManager=new d(l),c.appendChild(u(this.pageManager,this.garageApi));var p=e("To garage",(function(){c.innerHTML="",c.appendChild(u(t.pageManager,t.garageApi))})),h=e("To winners",(function(){c.innerHTML="",c.appendChild(function(){var t=document.createElement("div");t.classList.add("winners-block");var a=document.createElement("div");a.classList.add("header-winners"),t.appendChild(a);var i,c=document.createElement("table");function s(e){var t=document.createElement("th");return t.innerText=e,t}function d(e){var t=document.createElement("td");return t.innerText="".concat(e),t}c.classList.add("winners-table"),t.appendChild(c);var l=new r("http://localhost:3000/",{}),u=new n("http://localhost:3000/",{}),p=function(e){l.getWinners({page:e,limit:10,sort:"wins",order:"ASC"},(function(t){i=t.totalCount,a.innerText="Winners (".concat(i,")"),i<=10&&(C.disabled=!0);var n=document.createElement("div");a.appendChild(n),n.innerText="Page #".concat(e);var r=document.createElement("tr");c.appendChild(r),[s("Number"),s("Car"),s("Name"),s("Wins"),s("Best time (seconds)")].forEach((function(e){r.appendChild(e)})),t.rows.forEach((function(e,t){var n=document.createElement("tr");c.appendChild(n),u.getCar(e.id,(function(a){var r=d(t+1),i=document.createElement("td");i.appendChild(o(a.color)),[r,i,d(a.name),d(e.wins),d(e.time.toFixed(2))].forEach((function(e){n.appendChild(e)}))}))}))}))},h=1,v=document.createElement("div");v.classList.add("footer-winners-btns"),t.appendChild(v);var m=v.appendChild(e("prev",(function(){h-=1,c.innerHTML="",p(h),C.disabled=!1,h<=1&&(m.disabled=!0)})));m.disabled=!0,m.classList.add("footer-winner-button");var C=v.appendChild(e("next",(function(){h+=1,c.innerHTML="",p(h),m.disabled=!1,i/10<h+1&&(C.disabled=!0)})));return C.classList.add("footer-winner-button"),p(h),t}())}));s.appendChild(p),s.appendChild(h)},t}())).start()})();